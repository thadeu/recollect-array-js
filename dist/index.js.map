{"version":3,"file":"index.js","sources":["../src/predicates.ts","../src/utils.ts","../src/recollect-array.ts"],"sourcesContent":["import isFunction from 'lodash.isfunction'\nimport get from 'lodash.get'\n\nconst equals = (data, field, value) => get(data, field) == value\n\nconst contains = (data, field, value) => {\n  const target = get(data, field)\n\n  let startRegex = /^([^*])(\\w*)([*])$/\n  let endRegex = /^([*])(\\w*)([^*])$/\n  let includeRegex = /^\\*\\w*\\*$/\n\n  if (value.match(startRegex)) {\n    return String(target).startsWith(value.replace(/\\*$/, ''))\n  } else if (value.match(endRegex)) {\n    return String(target).endsWith(value.replace(/^\\*/, ''))\n  } else if (value.match(includeRegex)) {\n    return String(target).includes(value.replace(/^\\*/, '').replace(/\\*$/, ''))\n  } else {\n    return false\n  }\n}\n\nexport class Predicate {\n  static PREDICATES = [\n    'eq',\n    'not_eq',\n    'gte',\n    'lte',\n    'gt',\n    'lt',\n    'matches',\n    'not_matches',\n    'in',\n    'not_in',\n    'cont',\n    'not_cont',\n    'starts_with',\n    'not_starts_with',\n    'st',\n    'not_st',\n    'exists',\n    'not_exists',\n    'ex',\n    'not_ex'\n  ]\n\n  static factory(predicate, field, value) {\n    if (!this.PREDICATES.includes(predicate)) return undefined\n    if (!this[predicate]) return undefined\n\n    if (isFunction(value)) {\n      value = value()\n    }\n\n    return this[predicate](field, value)\n  }\n\n  static matches(field, value) {\n    return function (data) {\n      let target = [get(data, field)].flatMap((o) => o)\n      value = [value].flatMap((o) => o)\n\n      return value.some((o: any) => target.includes(o))\n    }\n  }\n\n  static not_matches(field, value) {\n    return !this.matches(field, value)\n  }\n\n  static exists(field, value) {\n    return (data) => {\n      if (String(value) == 'true') {\n        return this.not_in(field, ['', null, undefined])(data)\n      } else {\n        return this.in(field, ['', null, undefined])(data)\n      }\n    }\n  }\n\n  static not_exists(field, value) {\n    return (data) => {\n      return this.exists(field, false)(data)\n    }\n  }\n\n  static ex(field, value) {\n    return (data) => {\n      return this.exists(field, true)(data)\n    }\n  }\n\n  static not_ex(field, value) {\n    return (data) => {\n      return this.exists(field, false)(data)\n    }\n  }\n\n  static in(field, value) {\n    return (data) => {\n      return this.matches(field, value)(data)\n    }\n  }\n\n  static not_in(field, value) {\n    return (data) => {\n      return !this.matches(field, value)(data)\n    }\n  }\n\n  static eq(field, value) {\n    return function (data) {\n      return equals(data, field, value)\n    }\n  }\n\n  static not_eq(field, value) {\n    return function (data) {\n      return !equals(data, field, value)\n    }\n  }\n\n  static gte(field, value) {\n    return function (data) {\n      const target = get(data, field)\n\n      return target >= value\n    }\n  }\n\n  static gt(field, value) {\n    return function (data) {\n      const target = get(data, field)\n\n      return target > value\n    }\n  }\n\n  static lte(field, value) {\n    return function (data) {\n      const target = get(data, field)\n\n      return target <= value\n    }\n  }\n\n  static lt(field, value) {\n    return function (data) {\n      const target = get(data, field)\n\n      return target < value\n    }\n  }\n\n  static cont(field, value) {\n    return function (data) {\n      return contains(data, field, value)\n    }\n  }\n\n  static not_cont(field, value) {\n    return function (data) {\n      return !contains(data, field, value)\n    }\n  }\n\n  static starts_with(field, value) {\n    return function(data) {\n      return contains(data, field, `${value}*`)\n    }\n  }\n\n  static not_starts_with(field, value) {\n    return function(data) {\n      return !contains(data, field, `${value}*`)\n    }\n  }\n\n  static st(field, value) {\n    return function(data) {\n      return contains(data, field, `${value}*`)\n    }\n  }\n\n  static not_st(field, value) {\n    return function(data) {\n      return !contains(data, field, `${value}*`)\n    }\n  }\n}\n\nexport default Predicate\n","import filter from 'lodash.filter'\nimport last from 'lodash.last'\nimport chunk from 'lodash.chunk'\nimport isPlainObject from 'lodash.isplainobject'\n\nimport Predicate from '@/predicates'\n\nexport { isPlainObject }\n\nexport const chunkArray = (array: any[], size: number) => chunk(array, size)\n\nexport const filtering = (data: [], predicate: string, field: string, value: any) => {\n  return filter(data, Predicate.factory(predicate, field, value))\n}\n\nexport const applyRuleObject = (data, ruleField, ruleValue) => {\n  for (let [predicate, value] of Object.entries(ruleValue)) {\n    data = filtering(data, predicate, ruleField, value)\n  }\n\n  return data\n}\n\nexport const applyRuleValuable = (data, ruleField, ruleValue) => {\n  let fieldable = ruleField.split('_')\n  let predicate = last(fieldable) as string\n  let attr = ruleField.replace(`_${predicate}`, '')\n\n  return filtering(data, predicate, attr, ruleValue)\n}\n","import { applyRuleObject, applyRuleValuable, isPlainObject, chunkArray } from '@/utils'\n\nexport class RecollectArray {\n  static recollect = (data: any[], conditions: object): any[] => {\n    let entries = Object.entries(conditions).flatMap((a) => a)\n    let rules = chunkArray(entries, 2)\n\n    for (let [ruleField, ruleValue] of rules) {\n      if (isPlainObject(ruleValue)) {\n        data = applyRuleObject(data, ruleField, ruleValue)\n      } else {\n        data = applyRuleValuable(data, ruleField, conditions[ruleField as string])\n      }\n    }\n\n    return data\n  }\n\n  static filter(data: any[], conditions: object): any[] {\n    let clone = Array.from(data)\n    clone = this.recollect(clone, conditions)\n\n    return clone\n  }\n}\n\nexport default RecollectArray\n"],"names":["equals","data","field","value","get","contains","target","match","String","startsWith","replace","endsWith","includes","Predicate","factory","predicate","this","PREDICATES","isFunction","matches","flatMap","o","some","not_matches","exists","_this","not_in","undefined","not_exists","_this2","ex","_this3","not_ex","_this4","_this5","_this6","eq","not_eq","gte","gt","lte","lt","cont","not_cont","starts_with","not_starts_with","st","not_st","filtering","filter","applyRuleObject","ruleField","ruleValue","_i","_Object$entries","Object","entries","length","_Object$entries$_i","applyRuleValuable","fieldable","split","last","attr","RecollectArray","conditions","clone","Array","from","recollect","_step","a","_iterator","_createForOfIteratorHelperLoose","chunk","done","_step$value","isPlainObject"],"mappings":"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"}